@page
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@model ToyShop.Pages.ShopModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<div class="container-fluid py-5">
    <!-- Search Form -->
    <div class="d-flex justify-content-between align-items-center mb-4" style="width: 100%;">
        <form method="get" asp-page-handler="Search" class="d-flex" style="max-width: 400px;">
            <input type="text" name="searchName" placeholder="Search by content" class="form-control me-2" style="width:600px; height: 50px;" />
            <button type="submit" class="btn btn-primary custom-search-btn" style="height: 50px;">Search</button>
        </form>
    </div>

    <!-- Products List -->
    <div class="row g-4">
        @foreach (var toy in Model.Toys)
        {
            <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="card h-100 shadow-sm border-0 rounded">
                    <!-- Product Image -->
                    <div class="position-relative overflow-hidden rounded-top">
                        <img src="@Url.Content("~/img/" + toy.ToyImg)" class="card-img-top img-fluid" alt="Toy Image">
                        <div class="badge bg-dark position-absolute top-0 start-0 m-3 text-white" style="z-index: 10;">ToyShop</div>
                    </div>

                    <!-- Card Body -->
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title text-truncate" style="max-width: 100%;">@toy.ToyName</h5>
                        <p class="card-text text-truncate" style="max-width: 100%;">@(toy.ToyDescription?.Length > 50 ? toy.ToyDescription.Substring(0, 50) + "..." : toy.ToyDescription)</p>

                        <div class="d-flex flex-column justify-content-between mt-auto">
                            <!-- Price Section -->
                            <div class="d-flex justify-content-between">
                                <div class="me-2">
                                    <!-- Rent Price (Per Day) -->
                                    <p class="text-dark fs-5 fw-bold mb-1">Rent (Per Day): <span>@toy.ToyPriceRent.ToString("N0") VND</span> <span class="text-muted fs-6">/day</span></p>

                                    <!-- Sale Price -->
                                    <p class="text-dark fs-5 fw-bold mb-1">Price: <span>@toy.ToyPriceSale.ToString("N0") VND</span></p>
                                </div>

                                <div>
                                    <!-- Add to Cart Button -->
                                    <form method="post" asp-page="/Shop" asp-page-handler="AddToCart" class="d-inline-block">
                                        <input type="hidden" name="ToyId" value="@toy.Id" />
                                        <input type="hidden" name="Quantity" value="1" />
                                  
                                    </form>

                                </div>
                            </div>

                            <!-- View Details Button -->
                            <div class="text-center mt-3">
                                <a href="@Url.Page("./ShopDetail", new { id = toy.Id })" class="btn btn-outline-primary btn-sm rounded-pill">
                                    <i class="fa fa-info-circle me-2"></i> Chi tiết
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    @{
        var nextPageClass = Model.PageNumber == Model.TotalPages ? "disabled-btn" : "";
        var previousPage = Math.Max(Model.PageNumber - 1, 1);
        var nextPage = Math.Min(Model.PageNumber + 1, Model.TotalPages);
    }

    <div class="col-12">
        <div class="pagination d-flex justify-content-center mt-5">
            <!-- Previous Page Link -->
            <a asp-page="Shop" asp-route-pageNumber="@previousPage" class="page-link rounded-pill @(Model.PageNumber == 1 ? "disabled-btn" : "")">
                &laquo; Previous
            </a>

            <!-- Loop through pages -->
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <a asp-page="Shop" asp-route-pageNumber="@i" class="page-link rounded-pill @(Model.PageNumber == i ? "active" : "")">@i</a>
            }

            <!-- Next Page Link -->
            <a asp-page="Shop" asp-route-pageNumber="@nextPage" class="page-link rounded-pill @nextPageClass">
                Next &raquo;
            </a>
        </div>
    </div>

</div>
