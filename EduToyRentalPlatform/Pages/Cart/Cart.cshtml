@page
@model EduToyRentalPlatform.Pages.Cart.CartModel 
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<h2>Your Cart</h2>

@if (Model.MyCart != null)
{

    <!-- Bảng Mua - ContractType là true -->
    <h3 class="mt-4">Danh sách sản phẩm - Mua</h3>
    <table class="table table-striped table-responsive table-light">
        <thead>
            <tr>
                <th>Ảnh</th>
                <th>Tên đồ chơi</th>
                <th>Số lượng</th>
                <th>Giá</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.MyCart.Where(x => x.ContractType == true).ToList())
            {
                <tr>
                    <!-- Toy Image -->
                    <td class="text-left">
                        <img src="~/img/@item.Toy.ToyImg" alt="@item.Toy.ToyName" width="80" height="80" style="border-radius: 50%;" />
                    </td>
                    <!-- Toy Details -->
                    <td>
                        <h5 class="fw-bold mb-2">@item.Toy.ToyName</h5>
                    </td>

                    <!-- Quantity Selector -->
                    <td>
                        <div class="d-flex align-items-center">
                            <h5 class="fw-bold mb-2">@item.Quantity</h5>
                        </div>
                    </td>

                    <!-- Price -->
                    <td class="text-center">
                        <span class="price-text fw-bold">
                            @(item.ContractType.GetValueOrDefault(false) ? item.Toy.ToyPriceSale.ToString("C") : item.Toy.ToyPriceRent.ToString("C"))
                        </span>
                    </td>

                    <!-- Delete Button -->
                    <td class="text-end">
                        <!-- Delete Button -->
                        <div class="col-md-1 text-end">
                            <form method="post" asp-page-handler="Delete">
                                <input type="hidden" name="itemId" value="@item.Id" />
                                <input type="submit" value="Delete" class="btn btn-danger" />
                            </form>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>


    <!-- Bảng Thuê - ContractType là false -->
    <h3 class="mt-4">Danh sách sản phẩm - Thuê</h3>
    <table class="table table-striped table-responsive table-light">
        <thead>
            <tr>
                <th>Ảnh</th>
                <th>Tên đồ chơi</th>
                <th>Số lượng</th>
                <th>Giá</th>
                <th>Ngày bắt đầu thuê</th>
                <th>Ngày kết thúc thuê</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.MyCart.Where(x => x.ContractType == false).ToList())
            {
                <tr>
                    <!-- Toy Image -->
                    <td class="text-center">
                        <img src="~/img/@item.Toy.ToyImg" alt="@item.Toy.ToyName" width="80" height="80" style="border-radius: 50%;" />
                    </td>

                    <!-- Toy Details -->
                    <td>
                        <h5 class="fw-bold mb-2">@item.Toy.ToyName</h5>
                    </td>

                    <!-- Quantity Selector -->
                    <td>
                        <div class="d-flex align-items-center">
                            <h5 class="fw-bold mb-2">@item.Quantity</h5>
                        </div>
                    </td>


                    <!-- Price -->
                    <td class="text-left">
                        <span class="price-text fw-bold">
                            @(item.ContractType.GetValueOrDefault(false) ? item.Toy.ToyPriceSale.ToString("C") : item.Toy.ToyPriceRent.ToString("C"))
                        </span>
                    </td>
                    <td class="text-left">
                        <h5 class="fw-bold mb-2">@item.DateStart?.ToString("dd-MM-yyyyy")</h5>
                    </td>
                    <td class="text-left">
                        <h5 class="fw-bold mb-2">@item.DateEnd?.ToString("dd-MM-yyyy")</h5>
                    </td>


                    <!-- Delete Button -->
                    <td class="text-end">
                        <!-- Delete Button -->
                        <div class="col-md-1 text-end">
                            <form method="post" asp-page-handler="Delete">
                                <input type="hidden" name="itemId" value="@item.Id" />
                                <input type="submit" value="Delete" class="btn btn-danger" />
                            </form>

                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>



    <!-- Checkout Button -->
    <div class="d-flex justify-content-end mt-4">
        <button type="button" class="btn btn-primary btn-lg" onclick="window.location.href='/Cart/Checkout'">
            Thanh Toán
        </button>
    </div>


}
else
{
    <p>Your cart is empty.</p>
}
<script>
     
    function removeItem(itemId) {
        if (confirm(`Are you sure you want to remove from the cart?`)) {
            $.post('/Cart/Cart?handler=Delete', { itemId: itemId  })
                .done(() => location.reload())
                .fail(() => alert("An error occurred while removing the item."));
        }
    }
</script>